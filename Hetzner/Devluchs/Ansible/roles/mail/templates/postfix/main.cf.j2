myhostname = mail.devluchs.de
mydomain = devluchs.de
myorigin = $mydomain
inet_interfaces = all
inet_protocols = ipv6
mydestination = $myhostname, localhost.$mydomain, localhost
relay_domains =
home_mailbox = Maildir/
mailbox_command =
smtpd_tls_cert_file = /etc/letsencrypt/live/{{ postfix_dovecot_cert_name | default(certbot_domains | default([]) | first | default(inventory_hostname)) }}/fullchain.pem
smtpd_tls_key_file = /etc/letsencrypt/live/{{ postfix_dovecot_cert_name | default(certbot_domains | default([]) | first | default(inventory_hostname)) }}/privkey.pem
smtpd_use_tls = yes
smtpd_tls_auth_only = yes
smtpd_recipient_restrictions =
    permit_mynetworks,
    permit_sasl_authenticated,
    reject_unauth_destination
mynetworks = 127.0.0.0/8 [::1]/128 192.168.168.0/24
smtpd_sasl_type = dovecot
smtpd_sasl_path = private/auth
virtual_transport = lmtp:unix:private/dovecot-lmtp
smtp_tls_security_level = may
smtpd_tls_security_level = may
smtp_tls_loglevel = 1
smtpd_tls_loglevel = 1
smtp_tls_CAfile = /etc/ssl/certs/ca-certificates.crt
queue_directory = /var/spool/postfix
data_directory = /var/lib/postfix
compatibility_level = 2

# Placeholder relayhost if later needed for dual-stack outbound
# relayhost = [your-smarthost.example]:587

# Restrict plaintext auth to TLS
smtp_tls_note_starttls_offer = yes
smtpd_tls_received_header = yes
smtpd_relay_restrictions = permit_mynetworks permit_sasl_authenticated defer_unauth_destination
